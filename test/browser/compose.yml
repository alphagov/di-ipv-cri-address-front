version: "3.9"
services:
  db:
    image: redis
  mocks:
    image: wiremock/wiremock
    volumes:
      - "../mocks:/home/wiremock"
    ports:
      - "8090:8080"
  core-stub:
    image: ghcr.io/alphagov/di/di-ipv-core-stub:latest
    environment:
      CORE_STUB_SIGNING_PRIVATE_KEY_JWK_BASE64: 'eyJrdHkiOiAiRUMiLCJkIjogIk1abGdZaU1tb3ZiMXUtZldnY0lxU19VWWVHZm1GR0NLNzhIT0QxeG95RFUiLCJ1c2UiOiAic2lnIiwiY3J2IjogIlAtMjU2Iiwia2lkIjogInNpZy0xNjUyMjg3NDAyIiwieCI6ICI2T1B1alpMY09QY3o2RURORWlqdG5Ic1BneDY2bm5jbzFnZ0dOcUNqV09jIiwieSI6ICJsX0xaRkdyV2xOUjFXWXNPMjJFN3ZTazJoUW4waDgtMUxjbDVkT1JWeW8wIiwiYWxnIjogIkVTMjU2In0K'
      CORE_STUB_SIGNING_PUBLIC_JWK: '{"kty":"EC","crv":"P-256","x":"E9ZzuOoqcVU4pVB9rpmTzezjyOPRlOmPGJHKi8RSlIM","y":"KlTMZthHZUkYz5AleTQ8jff0TJiS3q2OB9L5Fw4xA04"}'
      CORE_STUB_CONFIG_FILE: "/app/di-ipv-config.yaml"
      CORE_STUB_USER_DATA_PATH: "/app/experian-uat-users-large.zip"

    volumes:
      - "./di-ipv-config.yaml:/app/di-ipv-config.yaml"
      - "${CORE_STUB_CONFIG_DIRECTORY}/keystore.jks:/app/keystore.jks"
      - "${CORE_STUB_CONFIG_DIRECTORY}/experian-uat-users-large.zip:/app/experian-uat-users-large.zip"
    ports:
      - "8085:8085"
  web-address:
    build:
      context: ../..
      dockerfile: local.Dockerfile
    environment:
      REDIS_SESSION_URL: db
      API_BASE_URL: http://172.17.0.1:8090
#      API_BASE_URL: http://mocks:8090
      PORT: 5010
      NODE_ENV: development
    ports:
      - "5010:5010"
    depends_on:
      - db
      - mocks
      - core-stub
    links:
      - mocks
